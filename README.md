# 📚 Novel Auto Generator | 小说自动生成器

<div align="center">

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![SillyTavern](https://img.shields.io/badge/SillyTavern-1.10%2B-green.svg)
![License](https://img.shields.io/badge/license-MIT-orange.svg)

**🚀 一款 SillyTavern 扩展插件，让 AI 自动为你续写小说，解放双手！
支持断点续传、智能导出、标签提取等功能**

[功能特性](#-功能特性) •
[快速开始](#-快速开始) •
[使用指南](#-使用指南) •
[高级功能](#-高级功能) •
[常见问题](#-常见问题)

</div>

---

## ✨ 功能特性



| 功能 | 描述 |
|:---:|:---|
| ⚡ **自动挂机生成** | 设定章节数，一键开始，自动发送提示词让 AI 持续创作 |
| 💾 **断点续传** | 随时暂停/恢复，进度自动保存，关闭页面也不丢失 |
| 🏷️ **智能标签提取** | 从 AI 回复中精准提取指定 XML 标签内容（如 `<content>`） |
| 📊 **实时统计** | 进度条、已用时间、预计剩余时间、错误统计一目了然 |
| 🔄 **自动重试** | 网络波动？响应超时？自动重试，稳定输出 |
| 📤 **多格式导出** | 支持 TXT / JSON 格式，灵活筛选楼层和消息类型 |

---

## 🚀 快速开始

### 安装步骤

1. **安装扩展**
   - 进入 `扩展` → `安装扩展`
   - 输入下面链接并安装。
   ```bash
   https://github.com/CyrilPeng/novel-auto-generator
   ```
2. **开始使用**
   - 启用扩展后，找到 📚 **小说自动生成器**
   - 设置目标章节数和提示词
   - 点击 ▶️ **开始**

---

## 📖 使用指南

### 🎯 基础用法：自动生成小说

```
1️⃣  打开一个角色对话（确保 AI 已有上下文）
     ↓
2️⃣  展开「📚 小说自动生成器」插件面板
     ↓
3️⃣  设置目标章节数（如 100 章）
     ↓
4️⃣  填写提示词（如 "继续"）
     ↓
5️⃣  点击 [▶️ 开始]
     ↓
6️⃣  挂机等待... 自动生成中 ☕
     ↓
7️⃣  完成后自动导出，或随时手动导出
```

### 💡 参考提示词
| 场景 | 提示词示例 |
|:---|:---|
| 简洁版 | 继续 |
| 标准版 | 继续推进剧情，保证流畅自然 |
| 详细版 | 请继续创作下一章，注意人物性格一致性，推进主线剧情 |
| 指定风格 | 继续，增加更多对话描写 |


---

## 🎯 高级功能

### 标签提取

当你使用正则表达式美化 AI 输出时，原始回复可能包含多种标签。
使用**标签提取**功能，可以只导出 `<content>` 标签内的正文。

```xml
<thinking>这是 AI 的思考过程...</thinking>

<content>
这里是小说正文内容，包含角色对话和情节描写...
</content>

<detail>总结...</detail>
```


### 使用方法

1. ✅ **勾选「原始 (chat.mes)」** — 必须！读取未经正则处理的原始内容（也就是点击小铅笔进行编辑时显示的内容）
2. 模式选择 **「只提取指定标签」**
3. 填写标签名：`content` 或 `content detail`（多标签用空格/逗号分隔）
4. 点击 **🔄 刷新预览** 确认提取效果
5. 导出时将只包含提取的内容！

### 多标签提取规则

| 输入方式 | 效果 |
|:---|:---|
| `content` | 只提取 `<content>` 标签 |
| `content detail` | 提取两个标签 |
| `content, detail, 正文` | 逗号分隔也可以 |

提取结果会按照原文中出现的顺序依次连接。

---

### 楼层范围导出

默认导出所有楼层，也可以指定范围：

| 场景 | 设置 |
|------|------|
| 场景一：导出全部 | ✅ 勾选「导出全部」|
| 场景二：只导出 10-50 楼 | 取消勾选，设置起始=10，结束=50 |
| 场景三：只导出最后 100 楼 | 计算楼层号后设置 |

> 💡 楼层从 **0** 开始计数，与 SillyTavern 一致

---

### 时间参数调整

在「高级设置」面板中可以调整各项时间参数：

| 参数 | 默认值 | 说明 |
|------|--------|------|
| 初始等待 | 2000ms | 发送消息后等待 AI 开始响应 |
| 完成等待 | 3000ms | AI 响应完成后的额外等待时间 |
| 稳定间隔 | 1000ms | 检查内容是否稳定的间隔 |
| 稳定次数 | 5 | 需要连续多少次检查内容不变 |
| 自动保存 | 50 | 每生成多少章自动保存一次 |
| 最大重试 | 3 | 单章失败后的最大重试次数 |
| 最小长度 | 100 | 低于此字数视为生成失败 |

---

## 🔧 调试

在浏览器控制台 (F12) 中可以使用调试命令：

```javascript
// 查看最后一条 AI 消息的原始内容
nagDebug()

// 查看指定楼层的原始内容（如第 5 楼）
nagDebug(5)
```

输出示例：
```
===== NovelGen Debug =====
✅ chat 获取成功，共 50 条

----- 楼层 49 -----
mes: <content>这里是原始内容...</content>

----- 标签测试 [content] -----
结果: 这里是原始内容...
```

---

## ❓ 常见问题

<details>
<summary><b>Q: 标签提取不生效？</b></summary>

请检查：
1. ✅ 是否勾选了「原始 (chat.mes)」
2. 标签名是否正确（区分大小写）
3. 使用 `nagDebug()` 查看原始内容中是否包含该标签

</details>

<details>
<summary><b>Q: 生成过程中报错重试？</b></summary>

可能原因：
- 响应时间过长，超过默认超时
- AI 回复过短，未达到最小长度
- 网络波动

解决方案：
- 在「高级设置」中增加等待时间
- 降低最小章节长度要求
- 检查网络连接

</details>

<details>
<summary><b>Q: 导出的内容是空的？</b></summary>

请检查：
1. 是否勾选了「🤖 AI 回复」
2. 楼层范围是否正确
3. 如果使用标签提取，确认标签名是否匹配

</details>

<details>
<summary><b>Q: 插件不显示？</b></summary>

1. 刷新页面
2. 检查浏览器控制台是否有错误
3. 确认扩展已启用
4. 尝试重新安装

</details>

---

## 📁 文件结构

```
novel-auto-generator/
├── manifest.json    # 扩展配置
├── index.js         # 主程序
├── style.css        # 样式表
└── README.md        # 说明文档
```

---


## 📊 工作流程图

```
                    ┌───────────────┐
                    │   点击开始    │
                    └───────┬───────┘
                            ▼
              ┌─────────────────────────┐
              │  检查是否已在运行/生成中 │
              └─────────────┬───────────┘
                            ▼
         ┌──────────────────────────────────┐
         │        循环: 当前章 < 目标章      │
         └──────────────────┬───────────────┘
                            ▼
                 ┌─────────────────┐
         ┌────── │   是否暂停？    │ ◄──┐
         │  是   └────────┬────────┘    │
         ▼                │ 否          │
    等待恢复信号  ─────────►│           │
                          ▼             │
              ┌─────────────────────┐   │
              │  发送提示词到 AI    │   │
              └─────────┬───────────┘   │
                        ▼               │
              ┌─────────────────────┐   │
              │  等待 AI 响应完成   │   │
              └─────────┬───────────┘   │
                        ▼               │
              ┌─────────────────────┐   │
              │  检查响应是否有效   │   │
              └─────────┬───────────┘   │
                        ▼               │
                  ┌───────────┐         │
                  │ 有效？    │         │
                  └─────┬─────┘         │
               是/      \否             │
              ▼          ▼              │
        保存进度    重试(最多3次)       │
        更新UI          │               │
              │         ▼               │
              │    还有重试机会？       │
              │    是→ 返回发送         │
              │    否→ 跳过本章         │
              │         │               │
              └────►────┴───────────────┘
                            ▼
              ┌─────────────────────────┐
              │     生成完成/被停止     │
              └─────────────┬───────────┘
                            ▼
              ┌─────────────────────────┐
              │      自动导出小说       │
              └─────────────────────────┘
```

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

- 🐛 发现 Bug？请提 Issue
- 💡 有新想法？欢迎讨论
- 🔧 代码改进？请提 PR

---

## 📜 更新日志

### v1.0.0
- 🎉 首次发布
- ✨ 自动生成功能
- ✨ 断点续传
- ✨ 标签提取
- ✨ 多格式导出
- ✨ 可折叠面板
- ✨ 帮助系统

---

## 📄 许可证

MIT License © 2024

---

<div align="center">

**Made with ❤️ for SillyTavern Community**

⭐ 如果这个插件对你有帮助，请给个 Star！

</div>